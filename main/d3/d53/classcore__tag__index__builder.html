<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.11.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Moodle PHP Documentation: core_tag_index_builder Class Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<script type="text/javascript" src="../../clipboard.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../cookie.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<link rel="search" href="../../search_opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="Moodle PHP Documentation"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen-styles.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../Moodle-Logo-ReversedWhite_RGB.svg"/></td>
  <td id="projectalign">
   <div id="projectname">Moodle PHP Documentation<span id="projectnumber">&#160;4.5</span>
   </div>
   <div id="projectbrief">Moodle 4.5dev (Build: 20240606) (d3ae1391abe)</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.11.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(1); });
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,true,'search.php','Search',false);
  $(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){ initResizable(false); });
/* @license-end */
</script>
</div><!-- top -->
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-static-methods">Static Public Member Functions</a> &#124;
<a href="#pro-methods">Protected Member Functions</a> &#124;
<a href="#pro-attribs">Protected Attributes</a> &#124;
<a href="../../d4/d5e/classcore__tag__index__builder-members.html">List of all members</a>  </div>
  <div class="headertitle"><div class="title">core_tag_index_builder Class Reference<div class="ingroups"><a class="el" href="../../df/dcd/group__core__tag.html">core_tag</a></div></div></div>
</div><!--header-->
<div class="contents">

<p>Helper to build tag index.  
 <a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a98c8e734e1c9f721b52504bd4c54a092" id="r_a98c8e734e1c9f721b52504bd4c54a092"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a98c8e734e1c9f721b52504bd4c54a092">__construct</a> ($component, $itemtype, $sql, $params, $from, $limit)</td></tr>
<tr class="memdesc:a98c8e734e1c9f721b52504bd4c54a092"><td class="mdescLeft">&#160;</td><td class="mdescRight">Constructor.  <br /></td></tr>
<tr class="separator:a98c8e734e1c9f721b52504bd4c54a092"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7e2dce8974731139f49b17eee7ab3736" id="r_a7e2dce8974731139f49b17eee7ab3736"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a7e2dce8974731139f49b17eee7ab3736">can_access_course</a> ($courseid)</td></tr>
<tr class="memdesc:a7e2dce8974731139f49b17eee7ab3736"><td class="mdescLeft">&#160;</td><td class="mdescRight">Checks if current user has access to the course.  <br /></td></tr>
<tr class="separator:a7e2dce8974731139f49b17eee7ab3736"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afeb36e3b739e714b480b003951ab091e" id="r_afeb36e3b739e714b480b003951ab091e"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#afeb36e3b739e714b480b003951ab091e">get_course</a> ($courseid)</td></tr>
<tr class="memdesc:afeb36e3b739e714b480b003951ab091e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Retrieves a course record (only fields id,visible,fullname,shortname,cacherev).  <br /></td></tr>
<tr class="separator:afeb36e3b739e714b480b003951ab091e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8c7613ef22690a1b30f98b3ec9636f8f" id="r_a8c7613ef22690a1b30f98b3ec9636f8f"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a8c7613ef22690a1b30f98b3ec9636f8f">get_items</a> ()</td></tr>
<tr class="memdesc:a8c7613ef22690a1b30f98b3ec9636f8f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns the filtered records from SQL query result.  <br /></td></tr>
<tr class="separator:a8c7613ef22690a1b30f98b3ec9636f8f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af0a1d46bfc8e32d22c8b5a57aaefc067" id="r_af0a1d46bfc8e32d22c8b5a57aaefc067"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#af0a1d46bfc8e32d22c8b5a57aaefc067">has_item_that_needs_access_check</a> ()</td></tr>
<tr class="memdesc:af0a1d46bfc8e32d22c8b5a57aaefc067"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns the first row from the SQL result that we don't know whether it is accessible by user or not.  <br /></td></tr>
<tr class="separator:af0a1d46bfc8e32d22c8b5a57aaefc067"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae7c0ef26c97763979a5bdb8f0c849766" id="r_ae7c0ef26c97763979a5bdb8f0c849766"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ae7c0ef26c97763979a5bdb8f0c849766">set_accessible</a> ($identifier, $accessible=true)</td></tr>
<tr class="memdesc:ae7c0ef26c97763979a5bdb8f0c849766"><td class="mdescLeft">&#160;</td><td class="mdescRight">Marks record or group of records as accessible (or not accessible)  <br /></td></tr>
<tr class="separator:ae7c0ef26c97763979a5bdb8f0c849766"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a137ee217ea79327665927012cad4a278" id="r_a137ee217ea79327665927012cad4a278"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a137ee217ea79327665927012cad4a278">walk</a> ($callable)</td></tr>
<tr class="memdesc:a137ee217ea79327665927012cad4a278"><td class="mdescLeft">&#160;</td><td class="mdescRight">Walk through the array of items and call $callable for each of them.  <br /></td></tr>
<tr class="separator:a137ee217ea79327665927012cad4a278"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-static-methods" name="pub-static-methods"></a>
Static Public Member Functions</h2></td></tr>
<tr class="memitem:ada5d11c198b56937bec7edb928f3a362" id="r_ada5d11c198b56937bec7edb928f3a362"><td class="memItemLeft" align="right" valign="top"><a id="ada5d11c198b56937bec7edb928f3a362" name="ada5d11c198b56937bec7edb928f3a362"></a>
static&#160;</td><td class="memItemRight" valign="bottom"><b>reset_caches</b> ()</td></tr>
<tr class="memdesc:ada5d11c198b56937bec7edb928f3a362"><td class="mdescLeft">&#160;</td><td class="mdescRight">Resets all course/items session caches - useful in unittests when we change users and enrolments. <br /></td></tr>
<tr class="separator:ada5d11c198b56937bec7edb928f3a362"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pro-methods" name="pro-methods"></a>
Protected Member Functions</h2></td></tr>
<tr class="memitem:a4b58a082472a8bd2960c3a94bf2f7dab" id="r_a4b58a082472a8bd2960c3a94bf2f7dab"><td class="memItemLeft" align="right" valign="top"><a id="a4b58a082472a8bd2960c3a94bf2f7dab" name="a4b58a082472a8bd2960c3a94bf2f7dab"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>init_course_access</b> ()</td></tr>
<tr class="memdesc:a4b58a082472a8bd2960c3a94bf2f7dab"><td class="mdescLeft">&#160;</td><td class="mdescRight">Ensures that we read the course access from the cache. <br /></td></tr>
<tr class="separator:a4b58a082472a8bd2960c3a94bf2f7dab"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa204affb93b5f6d12071253450da9011" id="r_aa204affb93b5f6d12071253450da9011"><td class="memItemLeft" align="right" valign="top"><a id="aa204affb93b5f6d12071253450da9011" name="aa204affb93b5f6d12071253450da9011"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>init_items_access</b> ()</td></tr>
<tr class="memdesc:aa204affb93b5f6d12071253450da9011"><td class="mdescLeft">&#160;</td><td class="mdescRight">Ensures that we read the items access from the cache. <br /></td></tr>
<tr class="separator:aa204affb93b5f6d12071253450da9011"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7f9fcae3c1c5a1fe0709e2ad6da0045c" id="r_a7f9fcae3c1c5a1fe0709e2ad6da0045c"><td class="memItemLeft" align="right" valign="top"><a id="a7f9fcae3c1c5a1fe0709e2ad6da0045c" name="a7f9fcae3c1c5a1fe0709e2ad6da0045c"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>prepare_sql_courses</b> ()</td></tr>
<tr class="memdesc:a7f9fcae3c1c5a1fe0709e2ad6da0045c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Substitute COURSEFILTER% with an expression filtering out courses where current user does not have access. <br /></td></tr>
<tr class="separator:a7f9fcae3c1c5a1fe0709e2ad6da0045c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1ce5edbce9527a482793721b362265ce" id="r_a1ce5edbce9527a482793721b362265ce"><td class="memItemLeft" align="right" valign="top"><a id="a1ce5edbce9527a482793721b362265ce" name="a1ce5edbce9527a482793721b362265ce"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>prepare_sql_items</b> ()</td></tr>
<tr class="memdesc:a1ce5edbce9527a482793721b362265ce"><td class="mdescLeft">&#160;</td><td class="mdescRight">Substitute ITEMFILTER% with an expression filtering out items where current user does not have access. <br /></td></tr>
<tr class="separator:a1ce5edbce9527a482793721b362265ce"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acffd6b22c5cf49dd939cd547e4e063f8" id="r_acffd6b22c5cf49dd939cd547e4e063f8"><td class="memItemLeft" align="right" valign="top"><a id="acffd6b22c5cf49dd939cd547e4e063f8" name="acffd6b22c5cf49dd939cd547e4e063f8"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>retrieve_items</b> ()</td></tr>
<tr class="memdesc:acffd6b22c5cf49dd939cd547e4e063f8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Ensures that SQL query was executed and $this-&gt;items is filled. <br /></td></tr>
<tr class="separator:acffd6b22c5cf49dd939cd547e4e063f8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a322a84849c26fc630eaa28c04f8d1724" id="r_a322a84849c26fc630eaa28c04f8d1724"><td class="memItemLeft" align="right" valign="top"><a id="a322a84849c26fc630eaa28c04f8d1724" name="a322a84849c26fc630eaa28c04f8d1724"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>save_caches</b> ()</td></tr>
<tr class="memdesc:a322a84849c26fc630eaa28c04f8d1724"><td class="mdescLeft">&#160;</td><td class="mdescRight">Saves course/items caches if needed. <br /></td></tr>
<tr class="separator:a322a84849c26fc630eaa28c04f8d1724"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pro-attribs" name="pro-attribs"></a>
Protected Attributes</h2></td></tr>
<tr class="memitem:ab52728bade55ef2a97bd428f4c324a04" id="r_ab52728bade55ef2a97bd428f4c324a04"><td class="memItemLeft" align="right" valign="top"><a id="ab52728bade55ef2a97bd428f4c324a04" name="ab52728bade55ef2a97bd428f4c324a04"></a>
array&#160;</td><td class="memItemRight" valign="bottom"><b>$accessibleitems</b></td></tr>
<tr class="memdesc:ab52728bade55ef2a97bd428f4c324a04"><td class="mdescLeft">&#160;</td><td class="mdescRight">cache of items accessibility (id =&gt; bool) <br /></td></tr>
<tr class="separator:ab52728bade55ef2a97bd428f4c324a04"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab27e713682874b31435f057086d3876d" id="r_ab27e713682874b31435f057086d3876d"><td class="memItemLeft" align="right" valign="top"><a id="ab27e713682874b31435f057086d3876d" name="ab27e713682874b31435f057086d3876d"></a>
bool&#160;</td><td class="memItemRight" valign="bottom"><b>$cachechangedaccessible</b> = false</td></tr>
<tr class="memdesc:ab27e713682874b31435f057086d3876d"><td class="mdescLeft">&#160;</td><td class="mdescRight">indicates that items cache was changed in this class and needs pushing to MUC <br /></td></tr>
<tr class="separator:ab27e713682874b31435f057086d3876d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9330cd03b030228abe83d7f63f1c53d7" id="r_a9330cd03b030228abe83d7f63f1c53d7"><td class="memItemLeft" align="right" valign="top"><a id="a9330cd03b030228abe83d7f63f1c53d7" name="a9330cd03b030228abe83d7f63f1c53d7"></a>
bool&#160;</td><td class="memItemRight" valign="bottom"><b>$cachechangedcourse</b> = false</td></tr>
<tr class="memdesc:a9330cd03b030228abe83d7f63f1c53d7"><td class="mdescLeft">&#160;</td><td class="mdescRight">indicates that course accessibiity cache was changed in this class and needs pushing to MUC <br /></td></tr>
<tr class="separator:a9330cd03b030228abe83d7f63f1c53d7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab361abf93e25ed4c6762b9e046fb7718" id="r_ab361abf93e25ed4c6762b9e046fb7718"><td class="memItemLeft" align="right" valign="top"><a id="ab361abf93e25ed4c6762b9e046fb7718" name="ab361abf93e25ed4c6762b9e046fb7718"></a>
string&#160;</td><td class="memItemRight" valign="bottom"><b>$component</b></td></tr>
<tr class="memdesc:ab361abf93e25ed4c6762b9e046fb7718"><td class="mdescLeft">&#160;</td><td class="mdescRight">component specified in the constructor <br /></td></tr>
<tr class="separator:ab361abf93e25ed4c6762b9e046fb7718"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1e371869cfb8467953257113d4d9b0b0" id="r_a1e371869cfb8467953257113d4d9b0b0"><td class="memItemLeft" align="right" valign="top"><a id="a1e371869cfb8467953257113d4d9b0b0" name="a1e371869cfb8467953257113d4d9b0b0"></a>
array&#160;</td><td class="memItemRight" valign="bottom"><b>$courseaccess</b></td></tr>
<tr class="memdesc:a1e371869cfb8467953257113d4d9b0b0"><td class="mdescLeft">&#160;</td><td class="mdescRight">cache of courses accessibility (courseid =&gt; bool) <br /></td></tr>
<tr class="separator:a1e371869cfb8467953257113d4d9b0b0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a04e7c4980bcf0643767b8802ffd6659e" id="r_a04e7c4980bcf0643767b8802ffd6659e"><td class="memItemLeft" align="right" valign="top"><a id="a04e7c4980bcf0643767b8802ffd6659e" name="a04e7c4980bcf0643767b8802ffd6659e"></a>
array&#160;</td><td class="memItemRight" valign="bottom"><b>$courses</b></td></tr>
<tr class="memdesc:a04e7c4980bcf0643767b8802ffd6659e"><td class="mdescLeft">&#160;</td><td class="mdescRight">cached courses (not pushed to MUC) <br /></td></tr>
<tr class="separator:a04e7c4980bcf0643767b8802ffd6659e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a48d34b6204064ccf55376bf74998832e" id="r_a48d34b6204064ccf55376bf74998832e"><td class="memItemLeft" align="right" valign="top"><a id="a48d34b6204064ccf55376bf74998832e" name="a48d34b6204064ccf55376bf74998832e"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><b>$from</b></td></tr>
<tr class="memdesc:a48d34b6204064ccf55376bf74998832e"><td class="mdescLeft">&#160;</td><td class="mdescRight">index from which to return records <br /></td></tr>
<tr class="separator:a48d34b6204064ccf55376bf74998832e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abf75b65b11197b74e0773ee41baacc6d" id="r_abf75b65b11197b74e0773ee41baacc6d"><td class="memItemLeft" align="right" valign="top"><a id="abf75b65b11197b74e0773ee41baacc6d" name="abf75b65b11197b74e0773ee41baacc6d"></a>
string&#160;</td><td class="memItemRight" valign="bottom"><b>$idfield</b> = 'id'</td></tr>
<tr class="memdesc:abf75b65b11197b74e0773ee41baacc6d"><td class="mdescLeft">&#160;</td><td class="mdescRight">alias of the item id in the SQL result <br /></td></tr>
<tr class="separator:abf75b65b11197b74e0773ee41baacc6d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a789d717ae1e5487131f96f4a41636640" id="r_a789d717ae1e5487131f96f4a41636640"><td class="memItemLeft" align="right" valign="top"><a id="a789d717ae1e5487131f96f4a41636640" name="a789d717ae1e5487131f96f4a41636640"></a>
array&#160;</td><td class="memItemRight" valign="bottom"><b>$itemkeys</b></td></tr>
<tr class="memdesc:a789d717ae1e5487131f96f4a41636640"><td class="mdescLeft">&#160;</td><td class="mdescRight">list of item ids ( array_keys($this-&gt;items) ) <br /></td></tr>
<tr class="separator:a789d717ae1e5487131f96f4a41636640"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a22f1a7fda1cea18df9d2448ece96201f" id="r_a22f1a7fda1cea18df9d2448ece96201f"><td class="memItemLeft" align="right" valign="top"><a id="a22f1a7fda1cea18df9d2448ece96201f" name="a22f1a7fda1cea18df9d2448ece96201f"></a>
array&#160;</td><td class="memItemRight" valign="bottom"><b>$items</b></td></tr>
<tr class="memdesc:a22f1a7fda1cea18df9d2448ece96201f"><td class="mdescLeft">&#160;</td><td class="mdescRight">result of SQL query <br /></td></tr>
<tr class="separator:a22f1a7fda1cea18df9d2448ece96201f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9994aa63ecf35bfa80975fd7ef2796fd" id="r_a9994aa63ecf35bfa80975fd7ef2796fd"><td class="memItemLeft" align="right" valign="top"><a id="a9994aa63ecf35bfa80975fd7ef2796fd" name="a9994aa63ecf35bfa80975fd7ef2796fd"></a>
string&#160;</td><td class="memItemRight" valign="bottom"><b>$itemtype</b></td></tr>
<tr class="memdesc:a9994aa63ecf35bfa80975fd7ef2796fd"><td class="mdescLeft">&#160;</td><td class="mdescRight">itemtype specified in the constructor <br /></td></tr>
<tr class="separator:a9994aa63ecf35bfa80975fd7ef2796fd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7c15bef7866d8ce7313bc516fd3517e7" id="r_a7c15bef7866d8ce7313bc516fd3517e7"><td class="memItemLeft" align="right" valign="top"><a id="a7c15bef7866d8ce7313bc516fd3517e7" name="a7c15bef7866d8ce7313bc516fd3517e7"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><b>$limit</b></td></tr>
<tr class="memdesc:a7c15bef7866d8ce7313bc516fd3517e7"><td class="mdescLeft">&#160;</td><td class="mdescRight">maximum number of records to return <br /></td></tr>
<tr class="separator:a7c15bef7866d8ce7313bc516fd3517e7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a676e4e82104510bda6c7871bc80cc5cb" id="r_a676e4e82104510bda6c7871bc80cc5cb"><td class="memItemLeft" align="right" valign="top"><a id="a676e4e82104510bda6c7871bc80cc5cb" name="a676e4e82104510bda6c7871bc80cc5cb"></a>
array&#160;</td><td class="memItemRight" valign="bottom"><b>$params</b></td></tr>
<tr class="memdesc:a676e4e82104510bda6c7871bc80cc5cb"><td class="mdescLeft">&#160;</td><td class="mdescRight">parameters for SQL statement <br /></td></tr>
<tr class="separator:a676e4e82104510bda6c7871bc80cc5cb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae2ed8bd63790059dd25789c61349129d" id="r_ae2ed8bd63790059dd25789c61349129d"><td class="memItemLeft" align="right" valign="top"><a id="ae2ed8bd63790059dd25789c61349129d" name="ae2ed8bd63790059dd25789c61349129d"></a>
string&#160;</td><td class="memItemRight" valign="bottom"><b>$sql</b></td></tr>
<tr class="memdesc:ae2ed8bd63790059dd25789c61349129d"><td class="mdescLeft">&#160;</td><td class="mdescRight">SQL statement. <br /></td></tr>
<tr class="separator:ae2ed8bd63790059dd25789c61349129d"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Helper to build tag index. </p>
<p>This can be used by components to implement tag area callbacks. This is especially useful for in-course content when we need to check and cache user's access to multiple courses. Course access and accessible items are stored in session cache with 15 minutes expiry time.</p>
<p>Example of usage:</p>
<p>$builder = new <a class="el" href="../../d3/d53/classcore__tag__index__builder.html" title="Helper to build tag index.">core_tag_index_builder</a>($component, $itemtype, $sql, $params, $from, $limit); while ($item = $builder-&gt;<a class="el" href="#af0a1d46bfc8e32d22c8b5a57aaefc067" title="Returns the first row from the SQL result that we don&#39;t know whether it is accessible by user or not.">has_item_that_needs_access_check()</a>) { if (!$builder-&gt;can_access_course($item-&gt;courseid)) { $builder-&gt;set_accessible($item, false); } else { $accessible = true; // Check access and set $accessible respectively. $builder-&gt;set_accessible($item, $accessible); } } $items = $builder-&gt;<a class="el" href="#a8c7613ef22690a1b30f98b3ec9636f8f" title="Returns the filtered records from SQL query result.">get_items()</a>;</p>
<dl class="section copyright"><dt>Copyright</dt><dd>2016 Marina Glancy </dd></dl>
<dl class="section user"><dt>License</dt><dd><a href="http://www.gnu.org/copyleft/gpl.html">http://www.gnu.org/copyleft/gpl.html</a> GNU GPL v3 or later </dd></dl>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="a98c8e734e1c9f721b52504bd4c54a092" name="a98c8e734e1c9f721b52504bd4c54a092"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a98c8e734e1c9f721b52504bd4c54a092">&#9670;&#160;</a></span>__construct()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">core_tag_index_builder::__construct </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>$component</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>$itemtype</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>$sql</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>$params</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>$from</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>$limit</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Constructor. </p>
<p>Specify the SQL query for retrieving the tagged items, SQL query must:</p><ul>
<li>return the item id as the first field and make sure that it is unique in the result</li>
<li>provide ORDER BY that exclude any possibility of random results, if $fromctx was specified when searching for tagged items it is the best practice to make sure that items from this context are returned first.</li>
</ul>
<p>This query may also contain placeholders COURSEFILTER% or ITEMFILTER% that will be substituted with expressions excluding courses and/or filters that are already known as inaccessible.</p>
<p>Example: "WHERE c.id %COURSEFILTER% AND cm.id %ITEMFILTER%"</p>
<p>This query may contain fields to preload context if context is needed for formatting values.</p>
<p>It is recommended to sort by course sortorder first, this way the items from the same course will be next to each other and the sequence of courses will the same in different tag areas.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$component</td><td>component responsible for tagging </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$itemtype</td><td>type of item that is being tagged </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$sql</td><td>SQL query that would retrieve all relevant items without permission check </td></tr>
    <tr><td class="paramtype">array</td><td class="paramname">$params</td><td>parameters for the query (must be named) </td></tr>
    <tr><td class="paramtype">int</td><td class="paramname">$from</td><td>return a subset of records, starting at this point </td></tr>
    <tr><td class="paramtype">int</td><td class="paramname">$limit</td><td>return a subset comprising this many records in total (this field is NOT optional) </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="a7e2dce8974731139f49b17eee7ab3736" name="a7e2dce8974731139f49b17eee7ab3736"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7e2dce8974731139f49b17eee7ab3736">&#9670;&#160;</a></span>can_access_course()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">core_tag_index_builder::can_access_course </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>$courseid</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Checks if current user has access to the course. </p>
<p>This method calls global function <a class="el" href="#a7e2dce8974731139f49b17eee7ab3736">can_access_course</a> and caches results</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">int</td><td class="paramname">$courseid</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">bool</td><td></td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="afeb36e3b739e714b480b003951ab091e" name="afeb36e3b739e714b480b003951ab091e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afeb36e3b739e714b480b003951ab091e">&#9670;&#160;</a></span>get_course()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">core_tag_index_builder::get_course </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>$courseid</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Retrieves a course record (only fields id,visible,fullname,shortname,cacherev). </p>
<p>This method is useful because it also caches results and preloads course context.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">int</td><td class="paramname">$courseid</td><td></td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a8c7613ef22690a1b30f98b3ec9636f8f" name="a8c7613ef22690a1b30f98b3ec9636f8f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8c7613ef22690a1b30f98b3ec9636f8f">&#9670;&#160;</a></span>get_items()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">core_tag_index_builder::get_items </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Returns the filtered records from SQL query result. </p>
<p>This function can only be executed after $builder-&gt;<a class="el" href="#af0a1d46bfc8e32d22c8b5a57aaefc067" title="Returns the first row from the SQL result that we don&#39;t know whether it is accessible by user or not.">has_item_that_needs_access_check()</a> returns null</p>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">array</td><td></td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="af0a1d46bfc8e32d22c8b5a57aaefc067" name="af0a1d46bfc8e32d22c8b5a57aaefc067"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af0a1d46bfc8e32d22c8b5a57aaefc067">&#9670;&#160;</a></span>has_item_that_needs_access_check()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">core_tag_index_builder::has_item_that_needs_access_check </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Returns the first row from the SQL result that we don't know whether it is accessible by user or not. </p>
<p>This will return null when we have necessary number of accessible items to return in <a class="el" href="#a8c7613ef22690a1b30f98b3ec9636f8f">get_items()</a></p>
<p>After analyzing you may decide to mark not only this record but all similar as accessible or not accessible. For example, if you already call <a class="el" href="../../d0/de1/group__core.html#ga30c04da283d2e3d9b0acd2eb34b90829" title="Returns reference to full info about modules in course (including visibility).">get_fast_modinfo()</a> to check this item's accessibility, why not mark all items in the same course as accessible or not accessible.</p>
<p>Helpful methods: <a class="el" href="#ae7c0ef26c97763979a5bdb8f0c849766">set_accessible()</a> and <a class="el" href="#a137ee217ea79327665927012cad4a278">walk()</a></p>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">null|object</td><td></td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ae7c0ef26c97763979a5bdb8f0c849766" name="ae7c0ef26c97763979a5bdb8f0c849766"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae7c0ef26c97763979a5bdb8f0c849766">&#9670;&#160;</a></span>set_accessible()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">core_tag_index_builder::set_accessible </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>$identifier</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>$accessible</em></span><span class="paramdefsep"> = </span><span class="paramdefval">true</span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Marks record or group of records as accessible (or not accessible) </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">int&#160;|&#160;std_Class</td><td class="paramname">$identifier</td><td>either record id of the item that needs to be set accessible </td></tr>
    <tr><td class="paramtype">bool</td><td class="paramname">$accessible</td><td>whether to mark as accessible or not accessible (default true) </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a137ee217ea79327665927012cad4a278" name="a137ee217ea79327665927012cad4a278"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a137ee217ea79327665927012cad4a278">&#9670;&#160;</a></span>walk()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">core_tag_index_builder::walk </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>$callable</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Walk through the array of items and call $callable for each of them. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">callable</td><td class="paramname">$callable</td><td></td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>tag/classes/<b>index_builder.php</b></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sun Jun 9 2024 02:54:35 for Moodle PHP Documentation by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.11.0
</small></address>
</div><!-- doc-content -->
</body>
</html>
