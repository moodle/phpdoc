<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Moodle PHP Documentation: core\access\get_user_capability_course_helper Class Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<script type="text/javascript" src="../../clipboard.js"></script>
<script type="text/javascript" src="../../cookie.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<link rel="search" href="../../search_opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="Moodle PHP Documentation"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen-styles.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../Moodle-Logo-ReversedWhite_RGB.svg"/></td>
  <td id="projectalign">
   <div id="projectname">Moodle PHP Documentation<span id="projectnumber">&#160;4.4</span>
   </div>
   <div id="projectbrief">Moodle 4.4+ (Build: 20240516) (bcae2164acd)</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,true,'search.php','Search');
  $(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../d9/d0f/namespacecore.html">core</a></li><li class="navelem"><a class="el" href="../../d6/dea/namespacecore_1_1access.html">access</a></li><li class="navelem"><a class="el" href="../../d0/d94/classcore_1_1access_1_1get__user__capability__course__helper.html">get_user_capability_course_helper</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-static-methods">Static Public Member Functions</a> &#124;
<a href="#pro-static-methods">Static Protected Member Functions</a> &#124;
<a href="../../d8/da1/classcore_1_1access_1_1get__user__capability__course__helper-members.html">List of all members</a>  </div>
  <div class="headertitle"><div class="title">core\access\get_user_capability_course_helper Class Reference<div class="ingroups"><a class="el" href="../../d0/de1/group__core.html">core</a></div></div></div>
</div><!--header-->
<div class="contents">

<p>Helper functions to implement the complex get_user_capability_course function.  
 <a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-static-methods" name="pub-static-methods"></a>
Static Public Member Functions</h2></td></tr>
<tr class="memitem:ac12387c4b6b09f3762f466f142427304" id="r_ac12387c4b6b09f3762f466f142427304"><td class="memItemLeft" align="right" valign="top">static&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ac12387c4b6b09f3762f466f142427304">get_sql</a> ($userid, $capability)</td></tr>
<tr class="memdesc:ac12387c4b6b09f3762f466f142427304"><td class="mdescLeft">&#160;</td><td class="mdescRight">Gets SQL to restrict a query to contexts in which the user has a capability.  <br /></td></tr>
<tr class="separator:ac12387c4b6b09f3762f466f142427304"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1c01eb017cf5fb0d0b84f47dac0694f8" id="r_a1c01eb017cf5fb0d0b84f47dac0694f8"><td class="memItemLeft" align="right" valign="top">static&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a1c01eb017cf5fb0d0b84f47dac0694f8">map_fieldnames</a> (string $fieldsexceptid='')</td></tr>
<tr class="memdesc:a1c01eb017cf5fb0d0b84f47dac0694f8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Map fieldnames to get ready for the SQL query.  <br /></td></tr>
<tr class="separator:a1c01eb017cf5fb0d0b84f47dac0694f8"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pro-static-methods" name="pro-static-methods"></a>
Static Protected Member Functions</h2></td></tr>
<tr class="memitem:ab407aaca31c3944cd395947c2690eaf2" id="r_ab407aaca31c3944cd395947c2690eaf2"><td class="memItemLeft" align="right" valign="top">static&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ab407aaca31c3944cd395947c2690eaf2">any_path_is_above</a> ($prohibitpaths, $otherpath)</td></tr>
<tr class="memdesc:ab407aaca31c3944cd395947c2690eaf2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Test if a context path $otherpath is the same as, or underneath, any of $prohibitpaths.  <br /></td></tr>
<tr class="separator:ab407aaca31c3944cd395947c2690eaf2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6a6683c177333a8c2167440a3a52c643" id="r_a6a6683c177333a8c2167440a3a52c643"><td class="memItemLeft" align="right" valign="top">static&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a6a6683c177333a8c2167440a3a52c643">calculate_permission_tree</a> (array $pathroleperms)</td></tr>
<tr class="memdesc:a6a6683c177333a8c2167440a3a52c643"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculates a permission tree based on an array of information about role permissions.  <br /></td></tr>
<tr class="separator:a6a6683c177333a8c2167440a3a52c643"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abad6aa3f6d0a88e9aa84dc0559ca34be" id="r_abad6aa3f6d0a88e9aa84dc0559ca34be"><td class="memItemLeft" align="right" valign="top">static&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#abad6aa3f6d0a88e9aa84dc0559ca34be">create_sql</a> ($parent)</td></tr>
<tr class="memdesc:abad6aa3f6d0a88e9aa84dc0559ca34be"><td class="mdescLeft">&#160;</td><td class="mdescRight">Creates SQL suitable for restricting by contexts listed in the given permission tree.  <br /></td></tr>
<tr class="separator:abad6aa3f6d0a88e9aa84dc0559ca34be"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af8b30cc31ef32d6a83ad14352f69b00d" id="r_af8b30cc31ef32d6a83ad14352f69b00d"><td class="memItemLeft" align="right" valign="top">static&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#af8b30cc31ef32d6a83ad14352f69b00d">get_capability_info_at_each_context</a> ($userid, $capability)</td></tr>
<tr class="memdesc:af8b30cc31ef32d6a83ad14352f69b00d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Based on the given user's access data (roles) and system role definitions, works out an array of capability values at each relevant context for the given user and capability.  <br /></td></tr>
<tr class="separator:af8b30cc31ef32d6a83ad14352f69b00d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5e289d5d09da0b2eb3e61c9a357525cc" id="r_a5e289d5d09da0b2eb3e61c9a357525cc"><td class="memItemLeft" align="right" valign="top">static&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a5e289d5d09da0b2eb3e61c9a357525cc">get_tree</a> ($userid, $capability)</td></tr>
<tr class="memdesc:a5e289d5d09da0b2eb3e61c9a357525cc"><td class="mdescLeft">&#160;</td><td class="mdescRight">Gets a permission tree for the given user and capability, representing the value of that capability at different contexts across the system.  <br /></td></tr>
<tr class="separator:a5e289d5d09da0b2eb3e61c9a357525cc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a91697557792749b02c54d5111f825b6b" id="r_a91697557792749b02c54d5111f825b6b"><td class="memItemLeft" align="right" valign="top">static&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a91697557792749b02c54d5111f825b6b">path_is_above</a> ($parentpath, $otherpath)</td></tr>
<tr class="memdesc:a91697557792749b02c54d5111f825b6b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Test if a context path $otherpath is the same as, or underneath, $parentpath.  <br /></td></tr>
<tr class="separator:a91697557792749b02c54d5111f825b6b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5a9cdf1525cf6eab95c05748b82902f6" id="r_a5a9cdf1525cf6eab95c05748b82902f6"><td class="memItemLeft" align="right" valign="top">static&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a5a9cdf1525cf6eab95c05748b82902f6">remove_duplicate_nodes</a> ($parent)</td></tr>
<tr class="memdesc:a5a9cdf1525cf6eab95c05748b82902f6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Removes duplicate nodes of a tree - where a child node has the same permission as its parent.  <br /></td></tr>
<tr class="separator:a5a9cdf1525cf6eab95c05748b82902f6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac8dd0bdd3124aae9934b667097d15fe2" id="r_ac8dd0bdd3124aae9934b667097d15fe2"><td class="memItemLeft" align="right" valign="top">static&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ac8dd0bdd3124aae9934b667097d15fe2">remove_negative_subtrees</a> ($root)</td></tr>
<tr class="memdesc:ac8dd0bdd3124aae9934b667097d15fe2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Given a permission tree (in calculate_permission_tree format), removes any subtrees that are negative from the root.  <br /></td></tr>
<tr class="separator:ac8dd0bdd3124aae9934b667097d15fe2"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Helper functions to implement the complex get_user_capability_course function. </p>
<dl class="section copyright"><dt>Copyright</dt><dd>2017 The Open University </dd></dl>
<dl class="section user"><dt>License</dt><dd><a href="http://www.gnu.org/copyleft/gpl.html">http://www.gnu.org/copyleft/gpl.html</a> GNU GPL v3 or later </dd></dl>
</div><h2 class="groupheader">Member Function Documentation</h2>
<a id="ab407aaca31c3944cd395947c2690eaf2" name="ab407aaca31c3944cd395947c2690eaf2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab407aaca31c3944cd395947c2690eaf2">&#9670;&#160;</a></span>any_path_is_above()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static core\access\get_user_capability_course_helper::any_path_is_above </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>$prohibitpaths</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>$otherpath</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Test if a context path $otherpath is the same as, or underneath, any of $prohibitpaths. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">array</td><td class="paramname">$prohibitpaths</td><td>array keys are context paths. </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$otherpath</td><td>the path of another context. </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">int</td><td>releavant $roleid if $otherpath is underneath (or equal to) any of the $prohibitpaths, 0 otherwise (so, can be used as a bool). </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a6a6683c177333a8c2167440a3a52c643" name="a6a6683c177333a8c2167440a3a52c643"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6a6683c177333a8c2167440a3a52c643">&#9670;&#160;</a></span>calculate_permission_tree()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static core\access\get_user_capability_course_helper::calculate_permission_tree </td>
          <td>(</td>
          <td class="paramtype">array</td>          <td class="paramname"><span class="paramname"><em>$pathroleperms</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Calculates a permission tree based on an array of information about role permissions. </p>
<p>The input parameter must be in the format returned by get_capability_info_at_each_context.</p>
<p>The output is the root of a tree of stdClass objects with the fields 'path' (a context path), 'allow' (true or false), and 'children' (an array of similar objects).</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">array</td><td class="paramname">$pathroleperms</td><td>Array of permissions </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">stdClass</td><td>Root object of permission tree </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="abad6aa3f6d0a88e9aa84dc0559ca34be" name="abad6aa3f6d0a88e9aa84dc0559ca34be"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abad6aa3f6d0a88e9aa84dc0559ca34be">&#9670;&#160;</a></span>create_sql()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static core\access\get_user_capability_course_helper::create_sql </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>$parent</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Creates SQL suitable for restricting by contexts listed in the given permission tree. </p>
<p>This function relies on the permission tree being in the format created by get_tree. Specifically, all the children of the root element must be set to 'allow' permission, children of those children must be 'not allow', children of those grandchildren 'allow', etc.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">stdClass</td><td class="paramname">$parent</td><td>Root node of permission tree </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">array</td><td>Two-element array of SQL (containing ? placeholders) and then a params array </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="af8b30cc31ef32d6a83ad14352f69b00d" name="af8b30cc31ef32d6a83ad14352f69b00d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af8b30cc31ef32d6a83ad14352f69b00d">&#9670;&#160;</a></span>get_capability_info_at_each_context()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static core\access\get_user_capability_course_helper::get_capability_info_at_each_context </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>$userid</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>$capability</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Based on the given user's access data (roles) and system role definitions, works out an array of capability values at each relevant context for the given user and capability. </p>
<p>This is organised by the effective context path (the one at which the capability takes effect) and then by role id. Note, however, that the resulting array only has the information that will be needed later. If there are Prohibits present in some roles, then they cannot be overridden by other roles or role overrides in lower contexts, therefore, such information, if any, is absent from the results.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">int</td><td class="paramname">$userid</td><td>User id </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$capability</td><td>Capability e.g. 'moodle/course:view' </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">array</td><td>Array of capability constants, indexed by context path and role id </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ac12387c4b6b09f3762f466f142427304" name="ac12387c4b6b09f3762f466f142427304"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac12387c4b6b09f3762f466f142427304">&#9670;&#160;</a></span>get_sql()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static core\access\get_user_capability_course_helper::get_sql </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>$userid</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>$capability</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Gets SQL to restrict a query to contexts in which the user has a capability. </p>
<p>This returns an array with two elements (SQL containing ? placeholders, and a params array). The SQL is intended to be used as part of a WHERE clause. It relies on the prefix 'x' being used for the <a class="el" href="../../d7/d79/namespace_moodle.html" title="&#160;">Moodle</a> context table.</p>
<p>If the user does not have the permission anywhere at all (so that there is no point doing the query) then the two returned values will both be false.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">int</td><td class="paramname">$userid</td><td>User id </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$capability</td><td>Capability e.g. 'moodle/course:view' </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">array</td><td>Two-element array of SQL (containing ? placeholders) and then a params array </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a5e289d5d09da0b2eb3e61c9a357525cc" name="a5e289d5d09da0b2eb3e61c9a357525cc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5e289d5d09da0b2eb3e61c9a357525cc">&#9670;&#160;</a></span>get_tree()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static core\access\get_user_capability_course_helper::get_tree </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>$userid</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>$capability</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Gets a permission tree for the given user and capability, representing the value of that capability at different contexts across the system. </p>
<p>The tree will be simplified as far as possible.</p>
<p>The output is the root of a tree of stdClass objects with the fields 'path' (a context path), 'allow' (true or false), and 'children' (an array of similar objects).</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">int</td><td class="paramname">$userid</td><td>User id </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$capability</td><td>Capability e.g. 'moodle/course:view' </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">stdClass</td><td>Root node of tree </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a1c01eb017cf5fb0d0b84f47dac0694f8" name="a1c01eb017cf5fb0d0b84f47dac0694f8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1c01eb017cf5fb0d0b84f47dac0694f8">&#9670;&#160;</a></span>map_fieldnames()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static core\access\get_user_capability_course_helper::map_fieldnames </td>
          <td>(</td>
          <td class="paramtype">string</td>          <td class="paramname"><span class="paramname"><em>$fieldsexceptid</em><span class="paramdefsep"> = </span><span class="paramdefval">''</span></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Map fieldnames to get ready for the SQL query. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$fieldsexceptid</td><td>A comma-separated list of the fields you require, not including id. Add ctxid, ctxpath, ctxdepth etc to return course context information for preloading. </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">string</td><td>Mapped field list for the SQL query. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a91697557792749b02c54d5111f825b6b" name="a91697557792749b02c54d5111f825b6b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a91697557792749b02c54d5111f825b6b">&#9670;&#160;</a></span>path_is_above()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static core\access\get_user_capability_course_helper::path_is_above </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>$parentpath</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>$otherpath</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Test if a context path $otherpath is the same as, or underneath, $parentpath. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$parentpath</td><td>the path of the parent context. </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$otherpath</td><td>the path of another context. </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">bool</td><td>true if $otherpath is underneath (or equal to) $parentpath. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a5a9cdf1525cf6eab95c05748b82902f6" name="a5a9cdf1525cf6eab95c05748b82902f6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5a9cdf1525cf6eab95c05748b82902f6">&#9670;&#160;</a></span>remove_duplicate_nodes()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static core\access\get_user_capability_course_helper::remove_duplicate_nodes </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>$parent</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Removes duplicate nodes of a tree - where a child node has the same permission as its parent. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">stdClass</td><td class="paramname">$parent</td><td>Tree root node </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ac8dd0bdd3124aae9934b667097d15fe2" name="ac8dd0bdd3124aae9934b667097d15fe2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac8dd0bdd3124aae9934b667097d15fe2">&#9670;&#160;</a></span>remove_negative_subtrees()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static core\access\get_user_capability_course_helper::remove_negative_subtrees </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>$root</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Given a permission tree (in calculate_permission_tree format), removes any subtrees that are negative from the root. </p>
<p>For example, if a top-level node of the permission tree has 'false' permission then it is meaningless because the default permission is already false; this function will remove it. However, if there is a child within that node that is positive, then that will need to be kept.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">stdClass</td><td class="paramname">$root</td><td>Root object </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">stdClass</td><td>Filtered tree root </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>lib/classes/access/<b>get_user_capability_course_helper.php</b></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sun May 19 2024 02:43:27 for Moodle PHP Documentation by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0
</small></address>
</body>
</html>
