<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Moodle PHP Documentation: core_availability\tree_node Class Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<script type="text/javascript" src="../../clipboard.js"></script>
<script type="text/javascript" src="../../cookie.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<link rel="search" href="../../search_opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="Moodle PHP Documentation"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen-styles.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../Moodle-Logo-ReversedWhite_RGB.svg"/></td>
  <td id="projectalign">
   <div id="projectname">Moodle PHP Documentation<span id="projectnumber">&#160;4.3</span>
   </div>
   <div id="projectbrief">Moodle 4.3.4+ (Build: 20240425) (840d58af5ec)</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,true,'search.php','Search');
  $(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../d9/d10/namespacecore__availability.html">core_availability</a></li><li class="navelem"><a class="el" href="../../d6/dea/classcore__availability_1_1tree__node.html">tree_node</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pro-static-methods">Static Protected Member Functions</a> &#124;
<a href="#pro-static-attribs">Static Protected Attributes</a> &#124;
<a href="../../d4/da0/classcore__availability_1_1tree__node-members.html">List of all members</a>  </div>
  <div class="headertitle"><div class="title">core_availability\tree_node Class Reference<div class="ingroups"><a class="el" href="../../de/d6c/group__core__availability.html">core_availability</a></div></div></div>
</div><!--header-->
<div class="contents">

<p>Node (base class) used to construct a tree of availability conditions.  
 <a href="#details">More...</a></p>
<div class="dynheader">
Inheritance diagram for core_availability\tree_node:</div>
<div class="dyncontent">
 <div class="center">
  <img src="../../d6/dea/classcore__availability_1_1tree__node.png" usemap="#core_5Favailability_5Ctree_5Fnode_map" alt=""/>
  <map id="core_5Favailability_5Ctree_5Fnode_map" name="core_5Favailability_5Ctree_5Fnode_map">
<area href="../../d0/db0/classcore__availability_1_1condition.html" title="Base class for a single availability condition." alt="core_availability\condition" shape="rect" coords="510,56,704,80"/>
<area href="../../dc/dca/classcore__availability_1_1tree.html" title="Class that holds a tree of availability conditions." alt="core_availability\tree" shape="rect" coords="714,56,908,80"/>
<area href="../../d5/d72/classavailability__completion_1_1condition.html" title="Activity completion condition." alt="availability_completion\condition" shape="rect" coords="0,112,194,136"/>
<area href="../../db/dab/classavailability__date_1_1condition.html" title="Date condition." alt="availability_date\condition" shape="rect" coords="204,112,398,136"/>
<area href="../../d3/d5d/classavailability__grade_1_1condition.html" title="Condition on grades of current user." alt="availability_grade\condition" shape="rect" coords="408,112,602,136"/>
<area href="../../dc/d3d/classavailability__group_1_1condition.html" title="Condition main class." alt="availability_group\condition" shape="rect" coords="612,112,806,136"/>
<area href="../../d1/d5e/classavailability__grouping_1_1condition.html" title="Condition main class." alt="availability_grouping\condition" shape="rect" coords="816,112,1010,136"/>
<area href="../../db/d6f/classavailability__profile_1_1condition.html" title="User profile field condition." alt="availability_profile\condition" shape="rect" coords="1020,112,1214,136"/>
  </map>
</div></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a2662af051b024c24f2cb5515e63f25e5" id="r_a2662af051b024c24f2cb5515e63f25e5"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a2662af051b024c24f2cb5515e63f25e5">check_available</a> ($not, <a class="el" href="../../d8/d46/classcore__availability_1_1info.html">core_availability\info</a> $<a class="el" href="../../d8/d46/classcore__availability_1_1info.html">info</a>, $grabthelot, $userid)</td></tr>
<tr class="memdesc:a2662af051b024c24f2cb5515e63f25e5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Determines whether this particular item is currently available according to the availability criteria.  <br /></td></tr>
<tr class="separator:a2662af051b024c24f2cb5515e63f25e5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7fdeb23d9151ac36695ee7aa9473cf4f" id="r_a7fdeb23d9151ac36695ee7aa9473cf4f"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a7fdeb23d9151ac36695ee7aa9473cf4f">filter_user_list</a> (array $users, $not, <a class="el" href="../../d8/d46/classcore__availability_1_1info.html">core_availability\info</a> $<a class="el" href="../../d8/d46/classcore__availability_1_1info.html">info</a>, <a class="el" href="../../db/d23/classcore__availability_1_1capability__checker.html">capability_checker</a> $checker)</td></tr>
<tr class="memdesc:a7fdeb23d9151ac36695ee7aa9473cf4f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Tests this condition against a user list.  <br /></td></tr>
<tr class="separator:a7fdeb23d9151ac36695ee7aa9473cf4f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afcdfd8dc9e493a341d6363917b33f9e3" id="r_afcdfd8dc9e493a341d6363917b33f9e3"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#afcdfd8dc9e493a341d6363917b33f9e3">get_user_list_sql</a> ($not, <a class="el" href="../../d8/d46/classcore__availability_1_1info.html">core_availability\info</a> $<a class="el" href="../../d8/d46/classcore__availability_1_1info.html">info</a>, $onlyactive)</td></tr>
<tr class="memdesc:afcdfd8dc9e493a341d6363917b33f9e3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Obtains SQL that returns a list of enrolled users that has been filtered by the conditions applied in the availability API, similar to calling get_enrolled_users and then filter_user_list.  <br /></td></tr>
<tr class="separator:afcdfd8dc9e493a341d6363917b33f9e3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aff32aa7bf54d058cada78079b4bdcaa1" id="r_aff32aa7bf54d058cada78079b4bdcaa1"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aff32aa7bf54d058cada78079b4bdcaa1">include_after_restore</a> ($restoreid, $courseid, <a class="el" href="../../df/d3c/classbase__logger.html">base_logger</a> $logger, $name, <a class="el" href="../../d2/de0/classbase__task.html">base_task</a> $task)</td></tr>
<tr class="memdesc:aff32aa7bf54d058cada78079b4bdcaa1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Checks whether this node should be included after restore or not.  <br /></td></tr>
<tr class="separator:aff32aa7bf54d058cada78079b4bdcaa1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1de470bfb2ad7eb00592b5b634832a04" id="r_a1de470bfb2ad7eb00592b5b634832a04"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a1de470bfb2ad7eb00592b5b634832a04">is_applied_to_user_lists</a> ()</td></tr>
<tr class="memdesc:a1de470bfb2ad7eb00592b5b634832a04"><td class="mdescLeft">&#160;</td><td class="mdescRight">Checks whether this condition applies to user lists.  <br /></td></tr>
<tr class="separator:a1de470bfb2ad7eb00592b5b634832a04"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac14507c8a62880b2e0cca944c5a5c739" id="r_ac14507c8a62880b2e0cca944c5a5c739"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ac14507c8a62880b2e0cca944c5a5c739">is_available_for_all</a> ($not=false)</td></tr>
<tr class="memdesc:ac14507c8a62880b2e0cca944c5a5c739"><td class="mdescLeft">&#160;</td><td class="mdescRight">Checks whether this condition is actually going to be available for all users under normal circumstances.  <br /></td></tr>
<tr class="separator:ac14507c8a62880b2e0cca944c5a5c739"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3a56b6c220513de3d79c84e639b546da" id="r_a3a56b6c220513de3d79c84e639b546da"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a3a56b6c220513de3d79c84e639b546da">save</a> ()</td></tr>
<tr class="memdesc:a3a56b6c220513de3d79c84e639b546da"><td class="mdescLeft">&#160;</td><td class="mdescRight">Saves tree data back to a structure object.  <br /></td></tr>
<tr class="separator:a3a56b6c220513de3d79c84e639b546da"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af4e962c24efe4e703dd66ae5c548db0d" id="r_af4e962c24efe4e703dd66ae5c548db0d"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#af4e962c24efe4e703dd66ae5c548db0d">update_after_restore</a> ($restoreid, $courseid, <a class="el" href="../../df/d3c/classbase__logger.html">base_logger</a> $logger, $name)</td></tr>
<tr class="memdesc:af4e962c24efe4e703dd66ae5c548db0d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Updates this node after restore, returning true if anything changed.  <br /></td></tr>
<tr class="separator:af4e962c24efe4e703dd66ae5c548db0d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaf8a8178086dd6249d5ec6b028ee7b00" id="r_aaf8a8178086dd6249d5ec6b028ee7b00"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aaf8a8178086dd6249d5ec6b028ee7b00">update_dependency_id</a> ($table, $oldid, $newid)</td></tr>
<tr class="memdesc:aaf8a8178086dd6249d5ec6b028ee7b00"><td class="mdescLeft">&#160;</td><td class="mdescRight">Updates this node if it contains any references (dependencies) to the given table and id.  <br /></td></tr>
<tr class="separator:aaf8a8178086dd6249d5ec6b028ee7b00"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pro-static-methods" name="pro-static-methods"></a>
Static Protected Member Functions</h2></td></tr>
<tr class="memitem:a97ba6eab3b91bfddcbf90cd0e31de3bd" id="r_a97ba6eab3b91bfddcbf90cd0e31de3bd"><td class="memItemLeft" align="right" valign="top">static&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a97ba6eab3b91bfddcbf90cd0e31de3bd">unique_sql_parameter</a> (array &amp;$params, $value)</td></tr>
<tr class="memdesc:a97ba6eab3b91bfddcbf90cd0e31de3bd"><td class="mdescLeft">&#160;</td><td class="mdescRight">Utility function for generating SQL parameters (because we can't use ? parameters because get_enrolled_sql has infected us with horrible named parameters).  <br /></td></tr>
<tr class="separator:a97ba6eab3b91bfddcbf90cd0e31de3bd"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pro-static-attribs" name="pro-static-attribs"></a>
Static Protected Attributes</h2></td></tr>
<tr class="memitem:ad4a32aa826eb99dad0d837e8ba681372" id="r_ad4a32aa826eb99dad0d837e8ba681372"><td class="memItemLeft" align="right" valign="top"><a id="ad4a32aa826eb99dad0d837e8ba681372" name="ad4a32aa826eb99dad0d837e8ba681372"></a>
static int&#160;</td><td class="memItemRight" valign="bottom"><b>$uniquesqlparametercounter</b> = 1</td></tr>
<tr class="memdesc:ad4a32aa826eb99dad0d837e8ba681372"><td class="mdescLeft">&#160;</td><td class="mdescRight">Counter to be used in <a class="el" href="">tree_node::unique_sql_parameter()</a>. <br /></td></tr>
<tr class="separator:ad4a32aa826eb99dad0d837e8ba681372"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Node (base class) used to construct a tree of availability conditions. </p>
<dl class="section copyright"><dt>Copyright</dt><dd>2014 The Open University </dd></dl>
<dl class="section user"><dt>License</dt><dd><a href="http://www.gnu.org/copyleft/gpl.html">http://www.gnu.org/copyleft/gpl.html</a> GNU GPL v3 or later </dd></dl>
</div><h2 class="groupheader">Member Function Documentation</h2>
<a id="a2662af051b024c24f2cb5515e63f25e5" name="a2662af051b024c24f2cb5515e63f25e5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2662af051b024c24f2cb5515e63f25e5">&#9670;&#160;</a></span>check_available()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">core_availability\tree_node::check_available </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>$not</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d8/d46/classcore__availability_1_1info.html">core_availability\info</a></td>          <td class="paramname"><span class="paramname"><em>$info</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>$grabthelot</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>$userid</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">abstract</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Determines whether this particular item is currently available according to the availability criteria. </p>
<ul>
<li>This does not include the 'visible' setting (i.e. this might return true even if visible is false); visible is handled independently.</li>
<li>This does not take account of the viewhiddenactivities capability. That should apply later.</li>
</ul>
<p>The $not option is potentially confusing. This option always indicates the 'real' value of NOT. For example, a condition inside a 'NOT AND' group will get this called with $not = true, but if you put another 'NOT OR' group inside the first group, then a condition inside that will be called with $not = false. We need to use the real values, rather than the more natural use of the current value at this point inside the tree, so that the information displayed to users makes sense.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">bool</td><td class="paramname">$not</td><td>Set true if we are inverting the condition </td></tr>
    <tr><td class="paramtype"><a class="el" href="../../d8/d46/classcore__availability_1_1info.html" title="Base class for conditional availability information (for module or section).">core_availability::info</a></td><td class="paramname">$info</td><td><a class="el" href="../../dc/d32/class_item.html" title="Manages all item-related data.">Item</a> we're checking </td></tr>
    <tr><td class="paramtype">bool</td><td class="paramname">$grabthelot</td><td>Performance hint: if true, caches information required for all course-modules, to make the front page and similar pages work more quickly (works only for current user) </td></tr>
    <tr><td class="paramtype">int</td><td class="paramname">$userid</td><td>User ID to check availability for </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">result</td><td>Availability check result </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a7fdeb23d9151ac36695ee7aa9473cf4f" name="a7fdeb23d9151ac36695ee7aa9473cf4f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7fdeb23d9151ac36695ee7aa9473cf4f">&#9670;&#160;</a></span>filter_user_list()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">core_availability\tree_node::filter_user_list </td>
          <td>(</td>
          <td class="paramtype">array</td>          <td class="paramname"><span class="paramname"><em>$users</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>$not</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d8/d46/classcore__availability_1_1info.html">core_availability\info</a></td>          <td class="paramname"><span class="paramname"><em>$info</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../db/d23/classcore__availability_1_1capability__checker.html">capability_checker</a></td>          <td class="paramname"><span class="paramname"><em>$checker</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Tests this condition against a user list. </p>
<p>Users who do not meet the condition will be removed from the list, unless they have the ability to view hidden activities/sections.</p>
<p>This function must be implemented if is_applied_to_user_lists returns true. Otherwise it will not be called.</p>
<p>The function must operate efficiently, e.g. by using a fixed number of database queries regardless of how many users are in the list.</p>
<p>Within this function, if you need to check capabilities, please use the provided checker which caches results where possible.</p>
<p>Conditions do not need to check the viewhiddenactivities or viewhiddensections capabilities. These are handled by <a class="el" href="../../d8/d46/classcore__availability_1_1info.html#aafc49a6e08c01d79cdbaf31f98fd9cd7" title="Tests against a user list.">core_availability::info::filter_user_list</a>.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">array</td><td class="paramname">$users</td><td>Array of userid =&gt; object </td></tr>
    <tr><td class="paramtype">bool</td><td class="paramname">$not</td><td>True if this condition is applying in negative mode </td></tr>
    <tr><td class="paramtype"><a class="el" href="../../d8/d46/classcore__availability_1_1info.html" title="Base class for conditional availability information (for module or section).">core_availability::info</a></td><td class="paramname">$info</td><td><a class="el" href="../../dc/d32/class_item.html" title="Manages all item-related data.">Item</a> we're checking </td></tr>
    <tr><td class="paramtype">capability_checker</td><td class="paramname">$checker</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">array</td><td>Filtered version of input array </td></tr>
  </table>
  </dd>
</dl>
<dl class="exception"><dt>Exceptions</dt><dd>
  <table class="exception">
    <tr><td class="paramname"><a class="el" href="../../da/d34/classcoding__exception.html" title="Exception indicating programming error, must be fixed by a programer.">coding_exception</a></td><td>If called on a condition that doesn't apply to user lists </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="afcdfd8dc9e493a341d6363917b33f9e3" name="afcdfd8dc9e493a341d6363917b33f9e3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afcdfd8dc9e493a341d6363917b33f9e3">&#9670;&#160;</a></span>get_user_list_sql()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">core_availability\tree_node::get_user_list_sql </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>$not</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d8/d46/classcore__availability_1_1info.html">core_availability\info</a></td>          <td class="paramname"><span class="paramname"><em>$info</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>$onlyactive</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Obtains SQL that returns a list of enrolled users that has been filtered by the conditions applied in the availability API, similar to calling get_enrolled_users and then filter_user_list. </p>
<p>As for filter_user_list, this ONLY filters out users with conditions that are marked as applying to user lists. For example, group conditions are included but date conditions are not included.</p>
<p>The returned SQL is a query that returns a list of user IDs. It does not include brackets, so you neeed to add these to make it into a subquery. You would normally use it in an SQL phrase like "WHERE u.id IN ($sql)".</p>
<p>The SQL will be complex and may be slow. It uses named parameters (sorry, I know they are annoying, but it was unavoidable here).</p>
<p>If there are no conditions, the returned result is array('', array()).</p>
<p>Conditions do not need to check the viewhiddenactivities or viewhiddensections capabilities. These are handled by <a class="el" href="../../d8/d46/classcore__availability_1_1info.html#ad4b70f9f65e41467111c0d5e14984001" title="Obtains SQL that returns a list of enrolled users that has been filtered by the conditions applied in...">core_availability::info::get_user_list_sql</a>.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">bool</td><td class="paramname">$not</td><td>True if this condition is applying in negative mode </td></tr>
    <tr><td class="paramtype"><a class="el" href="../../d8/d46/classcore__availability_1_1info.html" title="Base class for conditional availability information (for module or section).">core_availability::info</a></td><td class="paramname">$info</td><td><a class="el" href="../../dc/d32/class_item.html" title="Manages all item-related data.">Item</a> we're checking </td></tr>
    <tr><td class="paramtype">bool</td><td class="paramname">$onlyactive</td><td>If true, only returns active enrolments </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">array</td><td>Array with two elements: SQL subquery and parameters array </td></tr>
  </table>
  </dd>
</dl>
<dl class="exception"><dt>Exceptions</dt><dd>
  <table class="exception">
    <tr><td class="paramname"><a class="el" href="../../da/d34/classcoding__exception.html" title="Exception indicating programming error, must be fixed by a programer.">coding_exception</a></td><td>If called on a condition that doesn't apply to user lists </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="aff32aa7bf54d058cada78079b4bdcaa1" name="aff32aa7bf54d058cada78079b4bdcaa1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aff32aa7bf54d058cada78079b4bdcaa1">&#9670;&#160;</a></span>include_after_restore()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">core_availability\tree_node::include_after_restore </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>$restoreid</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>$courseid</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../df/d3c/classbase__logger.html">base_logger</a></td>          <td class="paramname"><span class="paramname"><em>$logger</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>$name</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d2/de0/classbase__task.html">base_task</a></td>          <td class="paramname"><span class="paramname"><em>$task</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Checks whether this node should be included after restore or not. </p>
<p>The node may be removed depending on restore settings, which you can get from the $task object.</p>
<p>By default nodes are still included after restore.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$restoreid</td><td>Restore ID </td></tr>
    <tr><td class="paramtype">int</td><td class="paramname">$courseid</td><td>ID of target course </td></tr>
    <tr><td class="paramtype"><a class="el" href="../../df/d3c/classbase__logger.html" title="Base abstract class for all the loggers to be used in backup/restore.">base_logger</a></td><td class="paramname">$logger</td><td>Logger for any warnings </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$name</td><td>Name of this item (for use in warning messages) </td></tr>
    <tr><td class="paramtype"><a class="el" href="../../d2/de0/classbase__task.html" title="Abstract class defining the basis for one execution (backup/restore) task.">base_task</a></td><td class="paramname">$task</td><td>Current restore task </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">bool</td><td>True if there was any change </td></tr>
  </table>
  </dd>
</dl>

<p>Reimplemented in <a class="el" href="../../dc/d3d/classavailability__group_1_1condition.html#af53ad13a6f150935676b5c56da1de374">availability_group\condition</a>, and <a class="el" href="../../d1/d5e/classavailability__grouping_1_1condition.html#a41973ff4d46016b0059bf813f43ef7f3">availability_grouping\condition</a>.</p>

</div>
</div>
<a id="a1de470bfb2ad7eb00592b5b634832a04" name="a1de470bfb2ad7eb00592b5b634832a04"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1de470bfb2ad7eb00592b5b634832a04">&#9670;&#160;</a></span>is_applied_to_user_lists()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">core_availability\tree_node::is_applied_to_user_lists </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Checks whether this condition applies to user lists. </p>
<p>The default is false (the condition is used to control access, but does not prevent the student from appearing in lists).</p>
<p>For example, group conditions apply to user lists: we do not want to include a student in a list of users if they are prohibited from accessing the activity because they don't belong to a relevant group. However, date conditions do not apply - we still want to show users in a list of people who might have submitted an assignment, even if they are no longer able to access the assignment in question because there is a date restriction.</p>
<p>The general idea is that conditions which are likely to be permanent (group membership, user profile) apply to user lists. Conditions which are likely to be temporary (date, grade requirement) do not.</p>
<p>Conditions which do apply to user lists must implement the filter_user_list function.</p>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">bool</td><td>True if this condition applies to user lists </td></tr>
  </table>
  </dd>
</dl>

<p>Reimplemented in <a class="el" href="../../dc/dca/classcore__availability_1_1tree.html#a3623e6351497272e2a670a056b084103">core_availability\tree</a>, <a class="el" href="../../dc/d3d/classavailability__group_1_1condition.html#a3e2c4262d916c99dfa83b2c5052a1ab5">availability_group\condition</a>, <a class="el" href="../../d1/d5e/classavailability__grouping_1_1condition.html#a84bcabd1dec8c9807e009a348f08df5c">availability_grouping\condition</a>, and <a class="el" href="../../db/d6f/classavailability__profile_1_1condition.html#a07da09212dcb5d80077695b66112acc7">availability_profile\condition</a>.</p>

</div>
</div>
<a id="ac14507c8a62880b2e0cca944c5a5c739" name="ac14507c8a62880b2e0cca944c5a5c739"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac14507c8a62880b2e0cca944c5a5c739">&#9670;&#160;</a></span>is_available_for_all()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">core_availability\tree_node::is_available_for_all </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>$not</em><span class="paramdefsep"> = </span><span class="paramdefval">false</span></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">abstract</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Checks whether this condition is actually going to be available for all users under normal circumstances. </p>
<p>Normally, if there are any conditions, then it may be hidden. However in the case of date conditions there are some conditions which will definitely not result in it being hidden for anyone.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">bool</td><td class="paramname">$not</td><td>Set true if we are inverting the condition </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">bool</td><td>True if condition will return available for everyone </td></tr>
  </table>
  </dd>
</dl>

<p>Reimplemented in <a class="el" href="../../d0/db0/classcore__availability_1_1condition.html#a73a84059d3818e0fc8f7b8e8c099ae2f">core_availability\condition</a>, <a class="el" href="../../dc/dca/classcore__availability_1_1tree.html#a5c67f23f2cce3fca2851cdd1842193a7">core_availability\tree</a>, and <a class="el" href="../../db/dab/classavailability__date_1_1condition.html#a6d7efdf3b0d4e3d1666bec9075553333">availability_date\condition</a>.</p>

</div>
</div>
<a id="a3a56b6c220513de3d79c84e639b546da" name="a3a56b6c220513de3d79c84e639b546da"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3a56b6c220513de3d79c84e639b546da">&#9670;&#160;</a></span>save()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">core_availability\tree_node::save </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">abstract</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Saves tree data back to a structure object. </p>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">stdClass</td><td>Structure object (ready to be made into JSON format) </td></tr>
  </table>
  </dd>
</dl>

<p>Reimplemented in <a class="el" href="../../dc/dca/classcore__availability_1_1tree.html#a4366c88dcf23c03bb7748cf078b29067">core_availability\tree</a>, <a class="el" href="../../d5/d72/classavailability__completion_1_1condition.html#aa1add6e51281e30e78e036f947190b30">availability_completion\condition</a>, <a class="el" href="../../db/dab/classavailability__date_1_1condition.html#a0def8c14e84fe1bae19499e9bf585838">availability_date\condition</a>, <a class="el" href="../../d3/d5d/classavailability__grade_1_1condition.html#a3772ea3a466aa422adfdcb76bd4d50f0">availability_grade\condition</a>, <a class="el" href="../../dc/d3d/classavailability__group_1_1condition.html#aa2b59d6a75d4ac6b6e87d4a169671009">availability_group\condition</a>, <a class="el" href="../../d1/d5e/classavailability__grouping_1_1condition.html#a10fdb547391e87088a5eb54a0da2836d">availability_grouping\condition</a>, and <a class="el" href="../../db/d6f/classavailability__profile_1_1condition.html#aaf50c56708b91506fbf9aa1a4edd4d39">availability_profile\condition</a>.</p>

</div>
</div>
<a id="a97ba6eab3b91bfddcbf90cd0e31de3bd" name="a97ba6eab3b91bfddcbf90cd0e31de3bd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a97ba6eab3b91bfddcbf90cd0e31de3bd">&#9670;&#160;</a></span>unique_sql_parameter()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static core_availability\tree_node::unique_sql_parameter </td>
          <td>(</td>
          <td class="paramtype">array &amp;</td>          <td class="paramname"><span class="paramname"><em>$params</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>$value</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Utility function for generating SQL parameters (because we can't use ? parameters because get_enrolled_sql has infected us with horrible named parameters). </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">array</td><td class="paramname">$params</td><td>Params array (value will be added to this array) </td></tr>
    <tr><td class="paramtype">string&#160;|&#160;int</td><td class="paramname">$value</td><td>Value </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">SQL</td><td>code for the parameter, e.g. ':pr1234' </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="af4e962c24efe4e703dd66ae5c548db0d" name="af4e962c24efe4e703dd66ae5c548db0d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af4e962c24efe4e703dd66ae5c548db0d">&#9670;&#160;</a></span>update_after_restore()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">core_availability\tree_node::update_after_restore </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>$restoreid</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>$courseid</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../df/d3c/classbase__logger.html">base_logger</a></td>          <td class="paramname"><span class="paramname"><em>$logger</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>$name</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Updates this node after restore, returning true if anything changed. </p>
<p>The default behaviour is simply to return false. If there is a problem with the update, $logger can be used to output a warning.</p>
<p>Note: If you need information about the date offset, call <a class="el" href="../../d8/d46/classcore__availability_1_1info.html#ae7bf990053eaeef80fa5c99c5f2c4644" title="Gets the date offset (amount by which any date values should be adjusted) for the current restore.">core_availability::info::get_restore_date_offset</a>($restoreid). For information on the restoring task and its settings, call <a class="el" href="../../d8/d46/classcore__availability_1_1info.html#ad254f4ee40652211fe822acc7d998875" title="Gets the restore task (specifically, the task that calls the update_after_restore method) for the cur...">core_availability::info::get_restore_task</a>($restoreid).</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$restoreid</td><td>Restore ID </td></tr>
    <tr><td class="paramtype">int</td><td class="paramname">$courseid</td><td>ID of target course </td></tr>
    <tr><td class="paramtype"><a class="el" href="../../df/d3c/classbase__logger.html" title="Base abstract class for all the loggers to be used in backup/restore.">base_logger</a></td><td class="paramname">$logger</td><td>Logger for any warnings </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$name</td><td>Name of this item (for use in warning messages) </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">bool</td><td>True if there was any change </td></tr>
  </table>
  </dd>
</dl>

<p>Reimplemented in <a class="el" href="../../db/dab/classavailability__date_1_1condition.html#a9bae929a91a9ae4e6247dee663999975">availability_date\condition</a>, <a class="el" href="../../dc/dca/classcore__availability_1_1tree.html#ae86cbb7389c1f8da17b6e5c726213be9">core_availability\tree</a>, <a class="el" href="../../d5/d72/classavailability__completion_1_1condition.html#a2d5994d4ee062602a01ca1fb7b9743da">availability_completion\condition</a>, <a class="el" href="../../d3/d5d/classavailability__grade_1_1condition.html#a28baf25ab6d1a1f1b47adf9a0fe97b35">availability_grade\condition</a>, <a class="el" href="../../dc/d3d/classavailability__group_1_1condition.html#a4f4891395cbe7fa3b61072f2be1918f1">availability_group\condition</a>, and <a class="el" href="../../d1/d5e/classavailability__grouping_1_1condition.html#ab94cb722e43e798663952fcafb15d61b">availability_grouping\condition</a>.</p>

</div>
</div>
<a id="aaf8a8178086dd6249d5ec6b028ee7b00" name="aaf8a8178086dd6249d5ec6b028ee7b00"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aaf8a8178086dd6249d5ec6b028ee7b00">&#9670;&#160;</a></span>update_dependency_id()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">core_availability\tree_node::update_dependency_id </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>$table</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>$oldid</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>$newid</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">abstract</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Updates this node if it contains any references (dependencies) to the given table and id. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$table</td><td>Table name e.g. 'course_modules' </td></tr>
    <tr><td class="paramtype">int</td><td class="paramname">$oldid</td><td>Previous ID </td></tr>
    <tr><td class="paramtype">int</td><td class="paramname">$newid</td><td>New ID </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">bool</td><td>True if it changed, otherwise false </td></tr>
  </table>
  </dd>
</dl>

<p>Reimplemented in <a class="el" href="../../d0/db0/classcore__availability_1_1condition.html#a6696c28f7f92866fe735b2c319c27233">core_availability\condition</a>, <a class="el" href="../../dc/dca/classcore__availability_1_1tree.html#a9fde407c7d5f95dcf82b80b626cfd21d">core_availability\tree</a>, <a class="el" href="../../d5/d72/classavailability__completion_1_1condition.html#aa95c662397dcfb9bdac4fe222c3bd758">availability_completion\condition</a>, <a class="el" href="../../d3/d5d/classavailability__grade_1_1condition.html#adc947c3d2793a15aa09eb0565f09bb37">availability_grade\condition</a>, <a class="el" href="../../dc/d3d/classavailability__group_1_1condition.html#a1ba1bb962d6c447c486036af160c0a90">availability_group\condition</a>, and <a class="el" href="../../d1/d5e/classavailability__grouping_1_1condition.html#ab26187acaa3b17a7b87d792e215bea9b">availability_grouping\condition</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>availability/classes/<b>tree_node.php</b></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sun Apr 28 2024 02:36:39 for Moodle PHP Documentation by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0
</small></address>
</body>
</html>
