<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Moodle PHP Documentation: Box\Spout\Reader\XLSX\Manager\SharedStringsCaching\CachingStrategyFactory Class Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<script type="text/javascript" src="../../clipboard.js"></script>
<script type="text/javascript" src="../../cookie.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<link rel="search" href="../../search_opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="Moodle PHP Documentation"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen-styles.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../Moodle-Logo-ReversedWhite_RGB.svg"/></td>
  <td id="projectalign">
   <div id="projectname">Moodle PHP Documentation<span id="projectnumber">&#160;4.1</span>
   </div>
   <div id="projectbrief">Moodle 4.1.10+ (Build: 20240425) (eba83406da6)</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,true,'search.php','Search');
  $(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><b>Box</b></li><li class="navelem"><b>Spout</b></li><li class="navelem"><a class="el" href="../../d6/dcc/namespace_box_1_1_spout_1_1_reader.html">Reader</a></li><li class="navelem"><a class="el" href="../../d3/db5/namespace_box_1_1_spout_1_1_reader_1_1_x_l_s_x.html">XLSX</a></li><li class="navelem"><a class="el" href="../../d4/dfb/namespace_box_1_1_spout_1_1_reader_1_1_x_l_s_x_1_1_manager.html">Manager</a></li><li class="navelem"><a class="el" href="../../d5/d5e/namespace_box_1_1_spout_1_1_reader_1_1_x_l_s_x_1_1_manager_1_1_shared_strings_caching.html">SharedStringsCaching</a></li><li class="navelem"><a class="el" href="../../dd/d39/class_box_1_1_spout_1_1_reader_1_1_x_l_s_x_1_1_manager_1_1_shared_strings_caching_1_1_caching_strategy_factory.html">CachingStrategyFactory</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-attribs">Public Attributes</a> &#124;
<a href="#pro-methods">Protected Member Functions</a> &#124;
<a href="../../d3/d2f/class_box_1_1_spout_1_1_reader_1_1_x_l_s_x_1_1_manager_1_1_shared_strings_caching_1_1_caching_strategy_factory-members.html">List of all members</a>  </div>
  <div class="headertitle"><div class="title">Box\Spout\Reader\XLSX\Manager\SharedStringsCaching\CachingStrategyFactory Class Reference</div></div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:adb63096015e02fee63dc4c9ab034dcc2" id="r_adb63096015e02fee63dc4c9ab034dcc2"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#adb63096015e02fee63dc4c9ab034dcc2">createBestCachingStrategy</a> ($sharedStringsUniqueCount, $tempFolder, $helperFactory)</td></tr>
<tr class="memdesc:adb63096015e02fee63dc4c9ab034dcc2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns the best caching strategy, given the number of unique shared strings and the amount of memory available.  <br /></td></tr>
<tr class="separator:adb63096015e02fee63dc4c9ab034dcc2"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-attribs" name="pub-attribs"></a>
Public Attributes</h2></td></tr>
<tr class="memitem:a6a9e18b081da9e07b10353528499080e" id="r_a6a9e18b081da9e07b10353528499080e"><td class="memItemLeft" align="right" valign="top">const&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a6a9e18b081da9e07b10353528499080e">AMOUNT_MEMORY_NEEDED_PER_STRING_IN_KB</a> = 12</td></tr>
<tr class="memdesc:a6a9e18b081da9e07b10353528499080e"><td class="mdescLeft">&#160;</td><td class="mdescRight">The memory amount needed to store a string was obtained empirically from this data:  <br /></td></tr>
<tr class="separator:a6a9e18b081da9e07b10353528499080e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa1ae555748d5439a1ccc38e15e5bea35" id="r_aa1ae555748d5439a1ccc38e15e5bea35"><td class="memItemLeft" align="right" valign="top">const&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aa1ae555748d5439a1ccc38e15e5bea35">MAX_NUM_STRINGS_PER_TEMP_FILE</a> = 10000</td></tr>
<tr class="memdesc:aa1ae555748d5439a1ccc38e15e5bea35"><td class="mdescLeft">&#160;</td><td class="mdescRight">To avoid running out of memory when extracting a huge number of shared strings, they can be saved to temporary files instead of in memory.  <br /></td></tr>
<tr class="separator:aa1ae555748d5439a1ccc38e15e5bea35"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pro-methods" name="pro-methods"></a>
Protected Member Functions</h2></td></tr>
<tr class="memitem:ac605ca76e9b77c7acbde8e001dce2a59" id="r_ac605ca76e9b77c7acbde8e001dce2a59"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ac605ca76e9b77c7acbde8e001dce2a59">getMemoryLimitFromIni</a> ()</td></tr>
<tr class="memdesc:ac605ca76e9b77c7acbde8e001dce2a59"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns the formatted "memory_limit" value.  <br /></td></tr>
<tr class="separator:ac605ca76e9b77c7acbde8e001dce2a59"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3210054cb9e45ea6a5b546801f97302d" id="r_a3210054cb9e45ea6a5b546801f97302d"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a3210054cb9e45ea6a5b546801f97302d">getMemoryLimitInKB</a> ()</td></tr>
<tr class="memdesc:a3210054cb9e45ea6a5b546801f97302d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns the PHP "memory_limit" in Kilobytes.  <br /></td></tr>
<tr class="separator:a3210054cb9e45ea6a5b546801f97302d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa834ef2a12f4b447d3c895f00fda0deb" id="r_aa834ef2a12f4b447d3c895f00fda0deb"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aa834ef2a12f4b447d3c895f00fda0deb">isInMemoryStrategyUsageSafe</a> ($sharedStringsUniqueCount)</td></tr>
<tr class="memdesc:aa834ef2a12f4b447d3c895f00fda0deb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns whether it is safe to use in-memory caching, given the number of unique shared strings and the amount of memory available.  <br /></td></tr>
<tr class="separator:aa834ef2a12f4b447d3c895f00fda0deb"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="adb63096015e02fee63dc4c9ab034dcc2" name="adb63096015e02fee63dc4c9ab034dcc2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adb63096015e02fee63dc4c9ab034dcc2">&#9670;&#160;</a></span>createBestCachingStrategy()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Box\Spout\Reader\XLSX\Manager\SharedStringsCaching\CachingStrategyFactory::createBestCachingStrategy </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>$sharedStringsUniqueCount</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>$tempFolder</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>$helperFactory</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Returns the best caching strategy, given the number of unique shared strings and the amount of memory available. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">int&#160;|&#160;null</td><td class="paramname">$sharedStringsUniqueCount</td><td>Number of unique shared strings (NULL if unknown) </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$tempFolder</td><td>Temporary folder where the temporary files to store shared strings will be stored </td></tr>
    <tr><td class="paramtype">HelperFactory</td><td class="paramname">$helperFactory</td><td>Factory to create helpers </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">CachingStrategyInterface</td><td>The best caching strategy </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ac605ca76e9b77c7acbde8e001dce2a59" name="ac605ca76e9b77c7acbde8e001dce2a59"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac605ca76e9b77c7acbde8e001dce2a59">&#9670;&#160;</a></span>getMemoryLimitFromIni()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">Box\Spout\Reader\XLSX\Manager\SharedStringsCaching\CachingStrategyFactory::getMemoryLimitFromIni </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Returns the formatted "memory_limit" value. </p>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">string</td><td></td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a3210054cb9e45ea6a5b546801f97302d" name="a3210054cb9e45ea6a5b546801f97302d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3210054cb9e45ea6a5b546801f97302d">&#9670;&#160;</a></span>getMemoryLimitInKB()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">Box\Spout\Reader\XLSX\Manager\SharedStringsCaching\CachingStrategyFactory::getMemoryLimitInKB </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Returns the PHP "memory_limit" in Kilobytes. </p>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">float</td><td></td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="aa834ef2a12f4b447d3c895f00fda0deb" name="aa834ef2a12f4b447d3c895f00fda0deb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa834ef2a12f4b447d3c895f00fda0deb">&#9670;&#160;</a></span>isInMemoryStrategyUsageSafe()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">Box\Spout\Reader\XLSX\Manager\SharedStringsCaching\CachingStrategyFactory::isInMemoryStrategyUsageSafe </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>$sharedStringsUniqueCount</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Returns whether it is safe to use in-memory caching, given the number of unique shared strings and the amount of memory available. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">int&#160;|&#160;null</td><td class="paramname">$sharedStringsUniqueCount</td><td>Number of unique shared strings (NULL if unknown) </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">bool</td><td></td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a id="a6a9e18b081da9e07b10353528499080e" name="a6a9e18b081da9e07b10353528499080e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6a9e18b081da9e07b10353528499080e">&#9670;&#160;</a></span>AMOUNT_MEMORY_NEEDED_PER_STRING_IN_KB</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const Box\Spout\Reader\XLSX\Manager\SharedStringsCaching\CachingStrategyFactory::AMOUNT_MEMORY_NEEDED_PER_STRING_IN_KB = 12</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>The memory amount needed to store a string was obtained empirically from this data: </p>
<hr  />
 <h2><a class="anchor" id="autotoc_md21"></a>
| Number of chars⁺ | Memory needed |</h2>
<p>| 3,000 | 1 MB | | 15,000 | 2 MB | | 30,000 | 5 MB | | 75,000 | 11 MB | | 150,000 | 21 MB | | 300,000 | 43 MB | | 750,000 | 105 MB | | 1,500,000 | 210 MB | | 2,250,000 | 315 MB | | 3,000,000 | 420 MB | </p>
<h2><a class="anchor" id="autotoc_md22"></a>
| 4,500,000 | 630 MB |</h2>
<p>⁺ All characters were 1 byte long</p>
<p>This gives a linear graph where each 1-byte character requires about 150 bytes to be stored. Given that some characters can take up to 4 bytes, we need 600 bytes per character to be safe. Also, there is on average about 20 characters per cell (this is entirely empirical data...).</p>
<p>This means that in order to store one shared string in memory, the memory amount needed is: =&gt; 20 * 600 ≈ 12KB </p>

</div>
</div>
<a id="aa1ae555748d5439a1ccc38e15e5bea35" name="aa1ae555748d5439a1ccc38e15e5bea35"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa1ae555748d5439a1ccc38e15e5bea35">&#9670;&#160;</a></span>MAX_NUM_STRINGS_PER_TEMP_FILE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const Box\Spout\Reader\XLSX\Manager\SharedStringsCaching\CachingStrategyFactory::MAX_NUM_STRINGS_PER_TEMP_FILE = 10000</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>To avoid running out of memory when extracting a huge number of shared strings, they can be saved to temporary files instead of in memory. </p>
<p>Then, when accessing a string, the corresponding file contents will be loaded in memory and the string will be quickly retrieved. The performance bottleneck is not when creating these temporary files, but rather when loading their content. Because the contents of the last loaded file stays in memory until another file needs to be loaded, it works best when the indexes of the shared strings are sorted in the sheet data. 10,000 was chosen because it creates small files that are fast to be loaded in memory. </p>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>lib/spout/src/Spout/Reader/XLSX/Manager/SharedStringsCaching/<b>CachingStrategyFactory.php</b></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sun Apr 28 2024 02:28:37 for Moodle PHP Documentation by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0
</small></address>
</body>
</html>
